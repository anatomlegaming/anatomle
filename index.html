<!DOCTYPE html>
<html>
<head>
    <title>ANATOMLE 3D | V24.2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        .ui-overlay { position: absolute; top: 20px; left: 20px; width: 300px; pointer-events: none; }
        .interactive { pointer-events: auto; }
        .feedback-item { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>
    <div class="ui-overlay">
        <h1 class="text-white text-3xl font-black italic tracking-tighter mb-4">ANATOMLE 3D</h1>
        
        <div class="bg-zinc-900/90 border border-zinc-800 p-4 rounded-xl interactive shadow-2xl">
            <p class="text-[10px] text-zinc-500 uppercase font-bold mb-2">Target: <span id="target-ui" class="text-emerald-500">Sacrum</span></p>
            <input id="guess-input" type="text" placeholder="Search structures..." 
                class="bg-black/50 border border-zinc-700 text-white outline-none w-full p-3 rounded-lg focus:border-emerald-500 transition-all">
            
            <div id="path-list" class="mt-4 space-y-2 max-height-[400px] overflow-y-auto">
                </div>
        </div>
    </div>

    <script>
        // 1. SCENE SETUP
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        camera.position.set(0, 1, 4);

        scene.add(new THREE.AmbientLight(0xffffff, 0.7));
        const sun = new THREE.DirectionalLight(0xffffff, 1);
        sun.position.set(5, 10, 5);
        scene.add(sun);

        // 2. LOADER SETUP WITH DRACO FIX
        const dracoLoader = new THREE.DRACOLoader();
        dracoLoader.setDecoderPath('https://www.gstatic.com/draco/v1/decoders/');
        
        const loader = new THREE.GLTFLoader();
        loader.setDRACOLoader(dracoLoader);

        let skeleton;
        let guesses = [];
        const TARGET_BONE = "Sacrum"; // Game Logic Target

        loader.load('./overview-skeleton.glb', (gltf) => {
            skeleton = gltf.scene;
            scene.add(skeleton);
            resetMaterials();
        }, undefined, (e) => console.error("Loader Error:", e));

        // 3. GAME LOGIC FUNCTIONS
        function resetMaterials() {
            skeleton.traverse(node => {
                if(node.isMesh) {
                    node.material = new THREE.MeshStandardMaterial({ 
                        color: 0x222222, transparent: true, opacity: 0.2 
                    });
                }
            });
        }

        const input = document.getElementById('guess-input');
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const val = input.value.trim();
                processGuess(val);
                input.value = '';
            }
        });

        function processGuess(guessName) {
            if (!skeleton) return;
            
            // Logic for visual feedback
            let status = "âœ…";
            let color = 0x10b981; // Emerald

            // Simple demo logic: if it's not the target, call it 'Ahead'
            if (guessName.toLowerCase() !== TARGET_BONE.toLowerCase()) {
                status = "ðŸ§¬";
                color = 0x3b82f6; // Blue
            }

            skeleton.traverse(node => {
                // Matching based on your screenshots (includes right-side 'r' suffix)
                if (node.isMesh && (node.name.toLowerCase() === guessName.toLowerCase() || node.name.toLowerCase() === guessName.toLowerCase() + 'r')) {
                    node.material = new THREE.MeshStandardMaterial({ 
                        color: color, emissive: color, emissiveIntensity: 0.5 
                    });
                }
            });

            // Add to UI List
            const div = document.createElement('div');
            div.className = "feedback-item flex justify-between bg-black/40 p-2 rounded border border-zinc-800 text-xs text-white uppercase font-bold";
            div.innerHTML = `<span>${guessName}</span><span>${status}</span>`;
            document.getElementById('path-list').prepend(div);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
